# sEMG-MMG_SYNC
- Synchronous acquisition and analysis for sEMG-MMG. NI9205 and TCP/IP were used to collect data generated by Quspin and BioSemi.
- You can download the UI_Collector.exe tool in Release for the task of sEMG-MMG acquisition, as shown in the following figure:

<p align="center">
  <img src="https://github.com/transover/sEMG-MMG_SYNC/blob/main/ExampleData/SignalAcquisition.gif" width="45%" />
  <img src="https://github.com/user-attachments/assets/cb5fd44a-fc6f-4f79-b5d3-36074266ab10" width="45%" />
</p>

# Instructions for Use
### 1. Using the NI9205 Acquisition Board and Installing the NI Driver:
- In the `NI-DAQmx_driver` directory, run `ni-daqmx_24.0_online.exe` and select the default installation settings.

### 2. Using the BioSemi Acquisition Device and Installing the TCP/IP Server:
- Download `ACTIVIEW806` from the `BioSemi` directory and use it directly. If LabView files are missing, install `LabView RuntimeEngine 2016 (64bit)/setup.exe`.
- Run the batch file in the `BioSemi` directory to launch `ActView806-Lores.exe`, and select the configuration file `ACTIVIEW806/Configuring/sEMG_A32_Config.cfg`.
- Set the TCP Server local port to `8888`, and choose TCP subset `A1~A32 (32)`.

### 3. Completing TCP/IP Connection and Viewing Acquisition Changes on ActView806 by Selecting A1~A32 After Successful Connection:
#### Steps:
        1. When the user starts collecting data, the server's TCP Listening round icon turns green, indicating that Biosemi ActiveTwo is listening and ready to establish a connection.
        2. After the user runs the client function and connects successfully, the TCP Connected circular icon in Biosemi ActiveTwo will turn green, indicating that Biosemi is transmitting data to the client.
        3. Read data (Once the connection is established, parameters are disabled and can only be modified after the connection is terminated. The number of bytes received and transmitted is also reported in Biosemi ActiveTwo.)

#### Notes:
        1. Users must ensure that the TCP/IP function parameters in the client match those set in Biosemi ActiveTwo.
        2. Note that since Biosemi ActiveTwo acts as a server, a connection cannot be established unless Biosemi ActiveTwo is running in display or recording mode.
        3. Parameters in Biosemi ActiveTwo are located on the TCP Server tab and must be adjusted before running Biosemi ActiveTwo. Once Biosemi ActiveTwo starts data acquisition, even in display mode, parameters cannot be changed.
        4. Be careful to select the number of channels; otherwise, even if the connection is successful, data cannot be read.
        5. Streaming through TCP/IP introduces several hundred milliseconds of delay and tens of milliseconds of jitter. Data streamed via TCP/IP cannot be used directly for precise timing and requires buffering.
        ![Data Transfer Protocol-24bit](https://github.com/user-attachments/assets/20d02826-d712-421e-8cf5-1f521aea045d)

#### Parameters (TCP/IP parameters used for connecting with Biosemi):
        •IP address (host):
            If running on the same machine as Biosemi ActiveTwo, set it to 127.0.0.1. Otherwise, use the IP address of the machine running Biosemi ActiveTwo.
        •Port (port):
            The port used for communication. It must match the port reported by the TCP server in Biosemi ActiveTwo. The default value is 8888.
        •Samples per packet (tcpsamples):
            This defines the number of sample points included in each packet sent by Biosemi ActiveTwo. It depends on the sampling rate chosen by the user.
        •Bytes per sample (bytes):
            This defines the number of bytes used to represent each sample. It is fixed regardless of the sampling rate and cannot be changed by the user.
        •Channels + triggers (channels):
            This shows the number of selected channels (plus triggers). It is controlled by the channels setting, which will be described later in the parameters section dedicated to EEG data (section: Biosemi parameters).
            This value must match the one reported by Biosemi ActiveTwo.

### 4. Launch UI_Collector and Follow Help Instructions to Complete Data Acquisition
1.  Launch the software. If the NI9205 is connected properly, the **[Connection Status]** indicator will light up; otherwise, an error message will pop up.
2.  Check **[Enable EMG]** to light up the **[EMG]** indicator.
3.  Enter the stimulus information and click **[Stimulus Presentation]**. An experiment paradigm prompt will appear; click **[OK]** to light up the **[Stimulus]** indicator.
4.  Click **[Record]** to light up the **[Acquisition Status]** indicator, indicating that data streams are being written to file in real time (to accurately record timestamps, you must click **[Record]** to enter recording mode before clicking **[Start]**).
5.  Click **[Start]** to light up the **[Display Status]** indicator, indicating that the NI task is active and data collection and display have started (if **[Record]** is not clicked, data will be previewed but not saved).
6.  Click **[Stop]** to turn off both **[Display Status]** and **[Acquisition Status]** indicators, indicating that the acquisition or preview task is paused (in stimulus presentation mode, **[Start]** cannot be clicked again).
7.  Click **[Close]** to turn off all indicators, indicating that the task has ended. To start a new acquisition, the software must be restarted.
8.  Click **[Save]** (not needed in recording mode) to save partial data from the graph into a custom file (Note: it is not recommended for saving all data, as real-time data can be saved automatically. Long-term recording with this method requires a large amount of memory).
9.  Click the toolbar **[Export (PDF)]** to export experimental information as a PDF file.
10. Click the toolbar **[View Timing]** to view timing information and compare the start and end times and delays of different modalities.
11. Click the toolbar **[Plot Image]** to plot high-resolution images and preview collected data.
12. Check **[Enable Filtering]** to filter real-time images without affecting the written data.
13. Check **[Enable Conversion]** to switch data units for real-time images and automatically convert values (configurable in **[Page 2]** under channel modality settings).
14. Click **[Channel Selection]** to switch the displayed channels.
15. The control bar widgets allow play, pause, global view, zoom, and removal control of real-time images.
16. Hover the mouse over any button to view its function information.

### 5. If Parallel Port Triggering is Needed, Follow Help Instructions to Configure Additional Driver Files
![Example of signal acquisition process](https://github.com/user-attachments/assets/cb5fd44a-fc6f-4f79-b5d3-36074266ab10)

------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 使用说明
### 1. 使用NI9205采集板卡，并安装NI驱动：
- NI-DAQmx_driver目录下的ni-daqmx_24.0_online.exe，选择默认安装配置即可

### 2. 使用BioSemi采集器，并安装TCP/IP服务端：
- 下载BioSemi目录下的ACTIVIEW806，直接使用，若缺少Labview文件则安装LabView RuntimeEngine 2016 (64bit)/setup.exe
- 运行BioSemi目录下的批处理文件启动ActView806-Lores.exe，并在配置文件中选择ACTIVIEW806/Configuring/sEMG_A32_Config.cfg
- 将TCP Server本地端口设置为8888，TCP subset 选择A1~A32(32)

### 3. 完成TCP/IP连接，成功连接时选择A1~A32查看ActView806界面的采集变化：
#### 步骤：
        1.当用户开始收集数据时，服务端 TCP Listening round图标变为绿色，表示Biosemi ActiveTwo正在侦听并准备建立连接。
        2.用户运行客户端函数，连接成功后，在Biosemi ActiveTwo中，TCP Connected圆形图标将变为绿色，这表明Biosemi正在向客户端传输数据。
        3.读取数据（连接建立后，参数被禁用，直到连接终止后才能更改，接收和传输的字节数也在Biosemi ActiveTwo中报告）

#### 注意事项：
        1.用户需要确保客户端TCP/IP函数中的参数与Biosemi ActiveTwo中设置的参数匹配。
        2.注意，由于Biosemi ActiveTwo充当服务器，除非Biosemi ActiveTwo系统在显示或记录模式下运行，否则无法建立连接。
        3.Biosemi ActiveTwo中的参数位于TCP服务器页签中，在运行Biosemi ActiveTwo前需要进行调整。在Biosemi ActiveTwo开始获取数据后，即使处于显示模式，也无法更改它们。
        4.注意选择通道数，如果不选择，即使成功连接也无法读数
        5.通过 TCP/IP 的流会导致几百毫秒的延迟和数十毫秒的抖动，不能直接将 TCP/IP 流式传输的数据用于精确时序，需要建立缓冲区
        ![Data Transfer Protocol-24bit](https://github.com/user-attachments/assets/20d02826-d712-421e-8cf5-1f521aea045d)

####  参数（TCP/IP包含用于与Biosemi建立连接的参数）：
        •IP地址 host:
            如果运行在用于运行Biosemi ActiveTwo的同一台计算机上，则值为127.0.0.1。否则，ip地址必须是运行Biosemi ActiveTwo的计算机的ip地址。
        •端口 port:
            用于通信的端口。它需要与Biosemi ActiveTwo中TCP服务端报告的值匹配，缺省值是8888。
        •采样数/包 tcpsamples:
            这是Biosemi ActiveTwo发送的每个数据包中包含的样本点数量。它取决于用户选择的采样频率。
        •字节/样本 bytes:
            这是Biosemi ActiveTwo用来表示每个样本的字节数。无论采样频率如何，它都是固定的，用户不能改变它。
        •通道数+触发器 channels:
            这显示了用户选择的通道数（加上触发器）。它由通道项控制，通道项将在专用于参数EEG数据的部分(小节:参数Biosemi)中进行描述。
            该值必须与Biosemi ActiveTwo中报告的值匹配。
### 4. 启动UI_Collector，并安装Help指示完成数据采集
1.  启动软件，硬件连接NI9205则可见 **【连接状态】** 指示灯亮，否则弹出错误提示
2.  勾选 **【启用肌电】**，可见 **【肌电】** 指示灯亮
3.  输入刺激信息，点击 **【刺激呈现】** ，弹出实验范式提示，点击 **【OK】** 可见 **【刺激】** 指示灯亮
4.  点击 **【记录】**，可见 **【采集状态】** 指示灯亮，表示数据流将实时写入文件（记录精确时间需要先点击 **【记录】** 进入记录模式，再点击 **【开始】**）
5.  点击 **【开始】**，可见 **【显示状态】** 指示灯亮，表示NI任务开启，开始采集并显示数据（如果没有点击 **【记录】** 则数据仅预览而不保存）
6.  点击 **【停止】**， **【显示状态】** 和 **【采集状态】** 指示灯灭，表示采集或预览任务暂停（在刺激呈现模式下不可再次点击 **【开始】**）
7.  点击 **【关闭】**，可见所有指示灯灭，表示任务结束，此时若要再次采集需重启软件
8.  点击 **【保存】**（记录模式下无需），将图中局部数据保存到自定义文件（注：全部数据时不推荐使用，实时数据可自动保存，使用该方式长时间记录需要大量内存）
9.  点击工具栏 **【导出(PDF)】**，可导出实验信息为PDF文件
10.  点击工具栏 **【查看时序】**，可查看时序信息，比较各模态的起止时间和延时
11.  点击工具栏 **【绘制图像】**，可绘制高清图像，预览采集数据
12.  勾选 **【启用滤波】**，可对实时图像滤波，不影响写入的数据
13.  勾选 **【启用转换】**，可切换实时图像的数据单位并自动转换数值（在 **【页面2】** 中可配置通道模态）
14.  点选 **【通道选择】**，可切换要显示的通道
15.  控件栏小组件，控制实时图像显示的播放、暂停、全局、缩放、移除
16.  鼠标悬停可查看各按钮的功能信息
### 5. 如果需要并口打标，需要按照Help指示另外配置驱动文件
- 通过界面上的菜单栏按钮，可以更改界面语言
